<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DictaMed</title>
    
    <!-- Favicon avec D bleu et M vert -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%23ffffff'/%3E%3Ctext x='10' y='75' font-family='Arial, sans-serif' font-size='52' font-weight='900' fill='%232563eb' letter-spacing='-2'%3ED%3C/text%3E%3Ctext x='53' y='75' font-family='Arial, sans-serif' font-size='52' font-weight='900' fill='%2310b981' letter-spacing='-2'%3EM%3C/text%3E%3C/svg%3E">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 50%, #10b981 100%);
            background-attachment: fixed;
            min-height: 100vh;
            padding: 15px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: moveBackground 60s linear infinite;
            z-index: 0;
            opacity: 0.3;
        }

        @keyframes moveBackground {
            0% { transform: translate(0, 0); }
            100% { transform: translate(40px, 40px); }
        }

        @media (min-width: 768px) {
            body {
                padding: 30px;
            }
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            box-shadow: 
                0 10px 40px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(255, 255, 255, 0.5) inset;
            padding: 25px;
            max-width: 1000px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @media (min-width: 768px) {
            .container {
                padding: 50px;
                border-radius: 40px;
            }
        }

        h1 {
            color: #1e293b;
            margin-bottom: 8px;
            text-align: center;
            font-size: 36px;
            font-weight: 800;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0;
            flex-wrap: wrap;
            letter-spacing: -1px;
            line-height: 1.2;
        }

        @media (min-width: 768px) {
            h1 {
                font-size: 52px;
                margin-bottom: 12px;
            }
        }

        .slogan {
            text-align: center;
            background: linear-gradient(135deg, #2563eb 0%, #10b981 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 15px;
            margin-bottom: 35px;
            font-weight: 600;
            letter-spacing: 0.5px;
        }

        @media (min-width: 768px) {
            .slogan {
                font-size: 18px;
                margin-bottom: 45px;
            }
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 0;
            overflow-x: auto;
            overflow-y: hidden;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 5px;
            padding-right: 40px; /* Laisse voir une partie du dernier onglet */
            scrollbar-width: thin;
            position: relative;
        }

        @media (min-width: 768px) {
            .tabs {
                padding-right: 0;
            }
        }

        /* Indicateur visuel de scroll - Gradient sur la droite */
        .tabs::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            bottom: 5px;
            width: 60px;
            background: linear-gradient(to left, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0) 100%);
            pointer-events: none;
            z-index: 2;
            transition: opacity 0.3s;
        }

        /* Masquer le gradient quand on est √† la fin du scroll */
        .tabs.scrolled-end::after {
            opacity: 0;
        }

        /* Fl√®che indicatrice anim√©e */
        .tabs::before {
            content: '‚Üí';
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 20px;
            color: #2563eb;
            font-weight: bold;
            z-index: 3;
            animation: bounce-horizontal 1.5s ease-in-out infinite;
            pointer-events: none;
            opacity: 0.8;
        }

        @keyframes bounce-horizontal {
            0%, 100% {
                transform: translateY(-50%) translateX(0);
            }
            50% {
                transform: translateY(-50%) translateX(8px);
            }
        }

        /* Masquer la fl√®che quand on scroll */
        .tabs.scrolled::before {
            opacity: 0;
        }

        .tabs::-webkit-scrollbar {
            height: 6px;
        }

        .tabs::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 10px;
        }

        .tabs::-webkit-scrollbar-thumb {
            background: linear-gradient(90deg, #2563eb 0%, #10b981 100%);
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(37, 99, 235, 0.3);
        }

        .tabs::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(90deg, #1d4ed8 0%, #059669 100%);
        }

        @media (min-width: 768px) {
            .tabs {
                gap: 12px;
                margin-bottom: 0;
                overflow-x: visible;
            }
            
            /* Masquer les indicateurs sur desktop o√π tout est visible */
            .tabs::after,
            .tabs::before {
                display: none;
            }
        }

        /* Message d'aide pour mobile */
        .tabs-hint {
            display: none;
            position: absolute;
            bottom: -28px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #2563eb 0%, #10b981 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            white-space: nowrap;
            animation: fadeInOut 4s ease-in-out;
            pointer-events: none;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        @keyframes fadeInOut {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-5px);
            }
            15%, 85% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-5px);
            }
        }

        @media (max-width: 767px) {
            .tabs-hint {
                display: block;
            }
        }

        .tab {
            padding: 12px 20px;
            background: #f8fafc;
            border: 2px solid transparent;
            border-radius: 16px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
        }

        .tab::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }

        .tab:hover::before {
            left: 100%;
        }

        .tab span:first-child {
            font-size: 18px;
            filter: grayscale(100%);
            transition: filter 0.3s;
        }

        @media (min-width: 768px) {
            .tab {
                padding: 14px 24px;
                font-size: 14px;
                border-radius: 18px;
            }
            
            .tab span:first-child {
                font-size: 20px;
            }
        }

        .tab:hover {
            background: #f1f5f9;
            color: #2563eb;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }

        .tab:hover span:first-child {
            filter: grayscale(0%);
        }

        .tab.active {
            background: linear-gradient(135deg, #2563eb 0%, #10b981 100%);
            color: white;
            border-color: transparent;
            box-shadow: 
                0 8px 24px rgba(37, 99, 235, 0.35),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            transform: translateY(-2px);
        }

        .tab.active span:first-child {
            filter: grayscale(0%) brightness(1.2);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 24px;
        }

        @media (min-width: 768px) {
            .form-group {
                margin-bottom: 28px;
            }
        }

        label {
            display: block;
            margin-bottom: 10px;
            color: #334155;
            font-weight: 600;
            font-size: 14px;
            letter-spacing: 0.3px;
        }

        @media (min-width: 768px) {
            label {
                font-size: 15px;
                margin-bottom: 12px;
            }
        }

        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            font-size: 15px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: #ffffff;
            font-weight: 500;
            color: #1e293b;
        }

        @media (min-width: 768px) {
            input[type="text"], input[type="password"] {
                padding: 16px 20px;
                border-radius: 16px;
                font-size: 16px;
            }
        }

        input[type="text"]:focus, input[type="password"]:focus {
            outline: none;
            border-color: #2563eb;
            background: white;
            box-shadow: 
                0 0 0 4px rgba(37, 99, 235, 0.1),
                0 4px 12px rgba(37, 99, 235, 0.15);
            transform: translateY(-2px);
        }

        input[type="text"]::placeholder, input[type="password"]::placeholder {
            color: #94a3b8;
            font-weight: 400;
        }

        /* Compteur de caract√®res */
        .char-counter {
            font-size: 12px;
            color: #64748b;
            text-align: right;
            margin-top: 4px;
            font-weight: 500;
            transition: color 0.3s;
        }

        .char-counter.warning {
            color: #f59e0b;
            font-weight: 600;
        }

        .char-counter.limit {
            color: #ef4444;
            font-weight: 700;
        }

        @media (min-width: 768px) {
            .char-counter {
                font-size: 13px;
                margin-top: 5px;
            }
        }

        .sections-container {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        @media (min-width: 768px) {
            .sections-container {
                gap: 25px;
                margin-bottom: 35px;
            }
        }

        .section-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            padding: 24px;
            border-radius: 24px;
            border: 2px solid #e2e8f0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
        }

        .section-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #e2e8f0 0%, #e2e8f0 100%);
            transition: all 0.4s;
        }

        @media (min-width: 768px) {
            .section-card {
                padding: 28px;
                border-radius: 28px;
            }
        }

        .section-card:hover {
            border-color: #2563eb;
            box-shadow: 
                0 12px 32px rgba(37, 99, 235, 0.12),
                0 0 0 1px rgba(37, 99, 235, 0.1) inset;
            transform: translateY(-4px);
        }

        .section-card:hover::before {
            background: linear-gradient(90deg, #2563eb 0%, #10b981 100%);
        }

        .section-card.has-recording {
            border-color: #10b981;
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            box-shadow: 
                0 8px 24px rgba(16, 185, 129, 0.15),
                0 0 0 1px rgba(16, 185, 129, 0.1) inset;
        }

        .section-card.has-recording::before {
            background: linear-gradient(90deg, #10b981 0%, #059669 100%);
        }

        .section-card.has-recording:hover {
            transform: translateY(-4px) scale(1.01);
        }

        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 8px;
        }

        @media (min-width: 768px) {
            .section-header {
                margin-bottom: 15px;
            }
        }

        .section-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (min-width: 768px) {
            .section-title {
                font-size: 18px;
                gap: 10px;
            }
        }

        .section-badge {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(37, 99, 235, 0.3);
        }

        @media (min-width: 768px) {
            .section-badge {
                padding: 5px 14px;
                border-radius: 20px;
                font-size: 12px;
            }
        }

        .section-badge.recorded {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            animation: pulse-recorded 2s ease-in-out infinite;
        }

        @keyframes pulse-recorded {
            0%, 100% {
                box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
            }
            50% {
                box-shadow: 0 4px 16px rgba(16, 185, 129, 0.5);
            }
        }

        .dictation-guide {
            background: #fff;
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 12px;
            font-size: 12px;
            color: #475569;
            line-height: 1.5;
        }

        @media (min-width: 768px) {
            .dictation-guide {
                border-radius: 10px;
                padding: 12px;
                margin-bottom: 15px;
                font-size: 13px;
                line-height: 1.6;
            }
        }

        .dictation-guide strong {
            color: #334155;
            display: block;
            margin-bottom: 4px;
        }

        @media (min-width: 768px) {
            .dictation-guide strong {
                margin-bottom: 6px;
            }
        }

        .recorder-controls {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-bottom: 18px;
        }

        @media (min-width: 480px) {
            .recorder-controls {
                gap: 8px;
            }
        }

        @media (min-width: 768px) {
            .recorder-controls {
                gap: 12px;
                margin-bottom: 20px;
            }
        }

        .recorder-controls button {
            flex: 1;
            min-width: 60px;
            padding: 10px 6px;
            border: none;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 3px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.08),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }

        @media (min-width: 480px) {
            .recorder-controls button {
                min-width: 70px;
                padding: 10px 8px;
                font-size: 11px;
                gap: 4px;
            }
        }

        .recorder-controls button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .recorder-controls button:active::before {
            width: 300px;
            height: 300px;
        }

        @media (min-width: 768px) {
            .recorder-controls button {
                padding: 14px 20px;
                border-radius: 16px;
                font-size: 14px;
                gap: 8px;
                flex-direction: row;
            }
        }

        .recorder-controls button span {
            font-size: 20px;
            position: relative;
            z-index: 1;
        }

        @media (min-width: 768px) {
            .recorder-controls button span {
                font-size: 20px;
            }
        }

        /* Texte des boutons responsive */
        .btn-text {
            position: relative;
            z-index: 1;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Afficher textes courts sur mobile */
        .btn-text-full {
            display: none;
        }

        .btn-text-short {
            display: inline;
        }

        @media (min-width: 768px) {
            .btn-text-full {
                display: inline;
            }
            
            .btn-text-short {
                display: none;
            }
        }

        .btn-record, .record-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-record:hover:not(:disabled), .record-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 20px rgba(239, 68, 68, 0.35),
                0 0 0 1px rgba(255, 255, 255, 0.2) inset;
        }

        .btn-stop, .stop-btn {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            color: white;
        }

        .btn-stop:hover:not(:disabled), .stop-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 20px rgba(100, 116, 139, 0.35),
                0 0 0 1px rgba(255, 255, 255, 0.2) inset;
        }

        .btn-pause {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-pause:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 20px rgba(245, 158, 11, 0.35),
                0 0 0 1px rgba(255, 255, 255, 0.2) inset;
        }

        .btn-pause:disabled, .recorder-controls button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-delete, .delete-btn {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            display: none;
        }

        .btn-delete:hover, .delete-btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 20px rgba(220, 38, 38, 0.35),
                0 0 0 1px rgba(255, 255, 255, 0.2) inset;
        }

        .recorder-controls button[id*="replay"] {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
        }

        .recorder-controls button[id*="replay"]:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 8px 20px rgba(6, 182, 212, 0.35),
                0 0 0 1px rgba(255, 255, 255, 0.2) inset;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        @media (min-width: 768px) {
            button {
                padding: 10px 20px;
                font-size: 14px;
            }
        }

        .timer {
            font-size: 16px;
            font-weight: 800;
            color: #1e293b;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Courier New', monospace;
            text-align: center;
            margin-bottom: 8px;
            letter-spacing: 2px;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            padding: 8px 16px;
            border-radius: 12px;
            display: inline-block;
            width: auto;
            min-width: 100px;
        }

        @media (min-width: 768px) {
            .timer {
                font-size: 20px;
                padding: 10px 20px;
            }
        }

        .status {
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 15px;
            text-align: center;
            padding: 8px 16px;
            background: #f8fafc;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s;
        }

        @media (min-width: 768px) {
            .status {
                font-size: 14px;
                padding: 10px 20px;
            }
        }

        .status.recording {
            color: #ef4444;
            background: #fef2f2;
            border-color: #fecaca;
            animation: pulse-status 2s ease-in-out infinite;
        }

        @keyframes pulse-status {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4);
            }
            50% {
                box-shadow: 0 0 0 8px rgba(239, 68, 68, 0);
            }
        }

        .recording-status {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            margin-bottom: 15px;
        }

        @media (min-width: 768px) {
            .recording-status {
                gap: 10px;
                margin-bottom: 18px;
            }
        }

        .audio-preview {
            margin-top: 10px;
        }

        audio {
            width: 100%;
            border-radius: 8px;
        }

        .submit-section {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 50%, #10b981 100%);
            padding: 30px;
            border-radius: 24px;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 
                0 12px 40px rgba(37, 99, 235, 0.3),
                0 0 0 1px rgba(255, 255, 255, 0.1) inset;
        }

        .submit-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
            animation: moveBackgroundSlow 40s linear infinite;
        }

        @keyframes moveBackgroundSlow {
            0% { transform: translate(0, 0); }
            100% { transform: translate(30px, 30px); }
        }

        @media (min-width: 768px) {
            .submit-section {
                padding: 35px;
                border-radius: 28px;
            }
        }

        .submit-info {
            color: white;
            margin-bottom: 18px;
            font-size: 14px;
            position: relative;
            z-index: 1;
        }

        @media (min-width: 768px) {
            .submit-info {
                margin-bottom: 20px;
                font-size: 15px;
            }
        }

        .recording-count {
            font-size: 15px;
            font-weight: 700;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 12px;
            display: inline-block;
            backdrop-filter: blur(10px);
        }

        @media (min-width: 768px) {
            .recording-count {
                font-size: 16px;
                padding: 10px 20px;
            }
        }

        .submit-btn {
            background: white;
            color: #2563eb;
            padding: 16px 40px;
            font-size: 16px;
            font-weight: 700;
            width: 100%;
            justify-content: center;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 4px 16px rgba(0, 0, 0, 0.15),
                0 0 0 1px rgba(37, 99, 235, 0.1) inset;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .submit-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(37, 99, 235, 0.1);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .submit-btn:active::before {
            width: 400px;
            height: 400px;
        }

        @media (min-width: 768px) {
            .submit-btn {
                padding: 18px 50px;
                font-size: 18px;
                border-radius: 18px;
            }
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 
                0 12px 32px rgba(37, 99, 235, 0.3),
                0 0 0 1px rgba(37, 99, 235, 0.2) inset;
        }

        .submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .submit-btn span {
            font-size: 22px;
            position: relative;
            z-index: 1;
        }

        @media (min-width: 768px) {
            .submit-btn span {
                font-size: 24px;
            }
        }

        #messageArea {
            margin-top: 20px;
            position: relative;
            z-index: 1;
        }

        @media (min-width: 768px) {
            #messageArea {
                margin-top: 24px;
            }
        }

        .success-message, .error-message {
            padding: 16px 20px;
            border-radius: 16px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
            animation: slideInMessage 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
            position: relative;
            overflow: hidden;
        }

        @media (min-width: 768px) {
            .success-message, .error-message {
                padding: 18px 24px;
                border-radius: 18px;
                font-size: 15px;
            }
        }

        .success-message::before, .error-message::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        @keyframes slideInMessage {
            from {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .success-message {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .error-message {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .recording-count {
            color: white;
            font-weight: 600;
            font-size: 16px;
        }

        .test-badge {
            display: inline-block;
            background: #f59e0b;
            color: white;
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 600;
            margin-left: 3px;
        }

        @media (min-width: 768px) {
            .test-badge {
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 12px;
                margin-left: 10px;
            }
        }

        .faq-item {
            background: #f8fafc;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .faq-item:hover {
            border-color: #2563eb;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
        }

        .faq-question {
            color: #1e293b;
            font-size: 18px;
            margin-bottom: 12px;
            font-weight: 700;
        }

        .faq-answer {
            color: #475569;
            font-size: 15px;
            line-height: 1.8;
            margin: 0;
        }

        .faq-answer strong {
            color: #2563eb;
        }

        .step-item {
            display: flex;
            gap: 12px;
            margin-bottom: 0;
            align-items: flex-start;
            position: relative;
        }

        @media (min-width: 768px) {
            .step-item {
                gap: 20px;
            }
        }

        .step-number {
            background: #2563eb;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            flex-shrink: 0;
            box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
            z-index: 1;
            position: relative;
            transition: all 0.3s;
        }

        @media (min-width: 768px) {
            .step-number {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }

            .step-number:hover {
                transform: scale(1.1);
                box-shadow: 0 8px 25px rgba(37, 99, 235, 0.5);
            }
        }

        .step-connector {
            width: 3px;
            height: 20px;
            background: linear-gradient(to bottom, #3b82f6, #8b5cf6);
            margin-left: 18px;
            border-radius: 2px;
            position: relative;
        }

        @media (min-width: 768px) {
            .step-connector {
                width: 4px;
                height: 30px;
                margin-left: 22px;
            }
        }

        .step-connector::before {
            content: '‚Üì';
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        @media (min-width: 768px) {
            .step-connector::before {
                font-size: 14px;
            }
        }

        .step-content {
            flex: 1;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #3b82f6;
            transition: all 0.3s;
            position: relative;
        }

        @media (min-width: 768px) {
            .step-content {
                padding: 25px;
                border-radius: 15px;
                border-left-width: 5px;
            }

            .step-content:hover {
                transform: translateX(5px);
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
            }
        }

        .step-icon {
            font-size: 24px;
            margin-bottom: 8px;
            display: inline-block;
        }

        @media (min-width: 768px) {
            .step-icon {
                font-size: 32px;
                margin-bottom: 10px;
            }
        }

        .step-content h4 {
            color: #1e40af;
            font-size: 16px;
            margin-bottom: 10px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (min-width: 768px) {
            .step-content h4 {
                font-size: 20px;
                margin-bottom: 12px;
                gap: 10px;
            }
        }

        .step-content p {
            color: #1e3a8a;
            font-size: 13px;
            line-height: 1.7;
            margin: 0;
        }

        @media (min-width: 768px) {
            .step-content p {
                font-size: 15px;
                line-height: 1.8;
            }
        }

        /* Am√©lioration du scroll sur mobile */
        @media (max-width: 767px) {
            ::-webkit-scrollbar {
                width: 4px;
                height: 4px;
            }

            ::-webkit-scrollbar-track {
                background: #f1f1f1;
            }

            ::-webkit-scrollbar-thumb {
                background: #888;
                border-radius: 2px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <span style="color: #2563eb; font-weight: 800;">Dicta</span><span style="color: #10b981; font-weight: 800; margin-left: -4px;">Med</span>
        </h1>
        <p class="slogan">
            O√π la voix rencontre les chiffres
        </p>

        <!-- Navigation en grille -->
        <div style="position: relative; margin-bottom: 35px;">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('normal')" title="Mode Normal">
                    <span>üè•</span>
                    <span class="tab-text">Mode Normal</span>
                </button>
                <button class="tab" onclick="switchTab('test')" title="Mode Test">
                    <span>üß™</span>
                    <span class="tab-text">Mode Test</span>
                    <span class="test-badge">D√âMO</span>
                </button>
                <button class="tab" onclick="switchTab('how')" title="Comment √ßa marche">
                    <span>üí°</span>
                    <span class="tab-text">Guide</span>
                </button>
                <button class="tab" onclick="switchTab('faq')" title="FAQ">
                    <span>‚ùì</span>
                    <span class="tab-text">FAQ</span>
                </button>
                <button class="tab" onclick="switchTab('contact')" title="Nous Contacter">
                    <span>üìß</span>
                    <span class="tab-text">Contact</span>
                </button>
            </div>
            <div class="tabs-hint">‚Üê Faites glisser pour voir plus ‚Üí</div>
        </div>

        <div id="messageArea"></div>

        <!-- TAB NORMAL -->
        <div id="tab-normal" class="tab-content active">
            <div class="form-group">
                <label for="username">üîê Identifiant *</label>
                <input type="text" id="username" placeholder="Votre identifiant" required>
            </div>

            <div class="form-group">
                <label for="accessCode">üîë Code d'acc√®s *</label>
                <input type="text" id="accessCode" placeholder="Votre code d'acc√®s" required>
            </div>

            <div class="form-group">
                <label for="patientNumber">üìù Num√©ro de Dossier Patient *</label>
                <input type="text" id="patientNumber" placeholder="Ex: 487/2025" maxlength="50" required oninput="updateCharCount('patientNumber', 50)">
                <div class="char-counter" id="counter-patientNumber">0/50</div>
            </div>

            <div class="form-group">
                <label for="patientName">üë§ Nom et Pr√©nom du Patient *</label>
                <input type="text" id="patientName" placeholder="Ex: Ben Saleh Kamel" maxlength="50" required oninput="updateCharCount('patientName', 50)">
                <div class="char-counter" id="counter-patientName">0/50</div>
            </div>

            <div class="sections-container" id="sections-normal"></div>
            
            <!-- Bouton pour ajouter partie 4 -->
            <div style="text-align: center; margin-bottom: 20px;" id="add-partie4-container">
                <button onclick="togglePartie4()" style="background: linear-gradient(135deg, #2563eb 0%, #10b981 100%); color: white; padding: 12px 25px; border: none; border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3); display: inline-flex; align-items: center; gap: 8px;">
                    <span>‚ûï</span> Ajouter Partie 4
                </button>
            </div>
            
            <div class="submit-section">
                <div class="submit-info">
                    <div class="recording-count" id="recordingCount-normal">0 section(s) enregistr√©e(s)</div>
                </div>
                <button class="submit-btn" id="submitBtn-normal" onclick="sendToN8n('normal')" disabled>
                    <span>üì§</span> Envoyer
                </button>
            </div>
        </div>

        <!-- TAB COMMENT √áA MARCHE -->
        <div id="tab-how" class="tab-content">
            <div style="max-width: 900px; margin: 0 auto;">
                <h2 style="color: #333; margin-bottom: 30px; text-align: center; font-size: 28px;">
                    üí° Comment √ßa marche ?
                </h2>
                
                <!-- PROBL√âMATIQUE -->
                <div style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border: 3px solid #dc2626; border-radius: 15px; padding: 30px; margin-bottom: 30px;">
                    <h3 style="color: #991b1b; margin-bottom: 20px; font-size: 24px; display: flex; align-items: center; gap: 10px;">
                        ‚ö†Ô∏è La Probl√©matique
                    </h3>
                    <p style="color: #7f1d1d; font-size: 16px; line-height: 1.8; margin-bottom: 15px;">
                        La saisie manuelle des donn√©es sur le logiciel SPSS repr√©sente un d√©fi majeur pour les √©tudiants en m√©decine.
                    </p>
                    <ul style="color: #7f1d1d; line-height: 2; margin-left: 25px; font-size: 16px;">
                        <li>‚è∞ <strong>√ânorm√©ment de temps</strong> pass√© √† saisir les donn√©es.</li>
                        <li>üß† <strong>Beaucoup de concentration</strong> requise.</li>
                        <li>üí™ <strong>T√¢che lourde et r√©p√©titive.</strong></li>
                        <li>üìä N√©cessaire pour les <strong>statistiques de th√®ses et m√©moires.</strong></li>
                    </ul>
                </div>

                <!-- SOLUTION -->
                <div style="background: linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%); border: 3px solid #16a34a; border-radius: 15px; padding: 30px; margin-bottom: 30px;">
                    <h3 style="color: #15803d; margin-bottom: 20px; font-size: 24px; display: flex; align-items: center; gap: 10px;">
                        ‚úÖ Notre Solution : DictaMed
                    </h3>
                    <p style="color: #14532d; font-size: 17px; line-height: 1.8; margin-bottom: 20px; font-weight: 600;">
                        Au lieu de saisir manuellement les donn√©es, vous allez simplement <strong>dicter les donn√©es cliniques</strong> de vos patients !
                    </p>
                    <div style="background: white; padding: 20px; border-radius: 12px; border-left: 5px solid #16a34a; margin-bottom: 15px;">
                        <p style="color: #14532d; font-size: 16px; line-height: 1.8; margin: 0;">
                            üé§ <strong>Vous dictez</strong> ‚Üí ü§ñ <strong>IA transcrit automatiquement</strong> ‚Üí üìä <strong>Fichier Excel rempli</strong> ‚Üí üìà <strong>Transformation en SPSS</strong>
                        </p>
                    </div>
                    <p style="color: #14532d; font-size: 15px; line-height: 1.7; font-style: italic;">
                        Notre plateforme d√©chiffre automatiquement votre message vocal et remplit un fichier Excel en ligne. Ce fichier sera ensuite transform√© en fichier SPSS par notre √©quipe.
                    </p>
                </div>

                <!-- PROCESSUS -->
                <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); border: 3px solid #2563eb; border-radius: 15px; padding: 35px;">
                    <h3 style="color: #1e40af; margin-bottom: 30px; font-size: 26px; text-align: center; display: flex; align-items: center; justify-content: center; gap: 12px;">
                        <span style="font-size: 32px;">üîÑ</span> Processus en 7 √©tapes
                    </h3>
                    
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-icon">üìã</div>
                            <h4>Fixez vos variables</h4>
                            <p>D√©terminez quelles donn√©es vous souhaitez collecter pour votre √©tude (√¢ge, sexe, ant√©c√©dents, r√©sultats biologiques, etc.).</p>
                        </div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step-item">
                        <div class="step-number" style="background: #7c3aed;">2</div>
                        <div class="step-content">
                            <div class="step-icon">üì§</div>
                            <h4>Envoyez-nous votre fichier SPSS</h4>
                            <p>Communiquez-nous un fichier SPSS avec les variables pr√©d√©finies que vous souhaitez utiliser.</p>
                        </div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step-item">
                        <div class="step-number" style="background: #059669;">3</div>
                        <div class="step-content">
                            <div class="step-icon">üîê</div>
                            <h4>Recevez vos identifiants</h4>
                            <p>Nous vous fournirons un <strong>identifiant</strong> et un <strong>code d'acc√®s</strong> personnalis√©s pour acc√©der au service.</p>
                        </div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step-item">
                        <div class="step-number" style="background: #dc2626;">4</div>
                        <div class="step-content">
                            <div class="step-icon">üóÇÔ∏è</div>
                            <h4>Plan de travail organis√©</h4>
                            <p>Nous divisons la saisie en <strong>3 √† 4 parties</strong> (donn√©es cliniques, ant√©c√©dents, biologie, etc.) pour faciliter l'enregistrement et garder des messages vocaux courts.</p>
                        </div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step-item">
                        <div class="step-number" style="background: #ea580c;">5</div>
                        <div class="step-content">
                            <div class="step-icon">üîó</div>
                            <h4>Lien Google Sheet personnalis√©</h4>
                            <p>Recevez un lien vers votre Google Sheet (Excel en ligne) sp√©cifique √† votre th√®se/m√©moire.</p>
                            <p style="margin-top: 10px; padding: 10px; background: #fef3c7; border-radius: 8px; font-size: 13px; color: #78350f;">
                                ‚ö†Ô∏è <strong>Important :</strong> L'application Google Sheets doit √™tre install√©e sur votre t√©l√©phone pour une meilleure exp√©rience. Si non, vous pouvez ouvrir le lien directement dans votre navigateur.<br>
                                üì± <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.docs.editors.sheets" target="_blank" style="color: #2563eb; text-decoration: underline; font-weight: 600;">T√©l√©charger pour Android</a><br>
                                üçé <a href="https://apps.apple.com/app/google-sheets/id842849113" target="_blank" style="color: #2563eb; text-decoration: underline; font-weight: 600;">T√©l√©charger pour iOS</a>
                            </p>
                        </div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step-item">
                        <div class="step-number" style="background: #0891b2;">6</div>
                        <div class="step-content">
                            <div class="step-icon">üé§</div>
                            <h4>Dictez vos donn√©es</h4>
                            <p>Pour chaque patient : <br>
                            <span style="display: inline-block; margin-top: 8px; padding: 8px 12px; background: #f0f9ff; border-radius: 6px; border-left: 3px solid #0891b2;">
                            ‚Ä¢ Saisissez le <strong>num√©ro de dossier.</strong><br>
                            ‚Ä¢ <strong>Dictez les informations</strong> selon le plan fix√©.<br>
                            ‚Ä¢ V√©rifiez vos donn√©es dans le Google Sheet en temps r√©el.
                            </span>
                            </p>
                        </div>
                    </div>

                    <div class="step-connector"></div>

                    <div class="step-item">
                        <div class="step-number" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">7</div>
                        <div class="step-content" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b;">
                            <div class="step-icon">üéâ</div>
                            <h4 style="color: #92400e;">Recevez votre fichier SPSS</h4>
                            <p style="color: #78350f;">Une fois tous les patients saisis, envoyez-nous un email. Nous vous enverrons le <strong>fichier SPSS complet</strong> pr√™t pour vos analyses statistiques !</p>
                        </div>
                    </div>
                </div>

                <!-- CTA -->
                <div style="background: linear-gradient(135deg, #2563eb 0%, #10b981 100%); border-radius: 15px; padding: 30px; margin-top: 30px; text-align: center; color: white;">
                    <h3 style="font-size: 24px; margin-bottom: 15px;">
                        üöÄ Pr√™t √† gagner du temps ?
                    </h3>
                    <p style="font-size: 16px; margin-bottom: 20px; line-height: 1.6;">
                        Testez gratuitement notre solution en Mode Test ou contactez-nous pour d√©marrer votre projet !
                    </p>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="switchTab('test')" style="background: white; color: #2563eb; padding: 15px 30px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            üß™ Essayer le Mode Test
                        </button>
                        <button onclick="switchTab('contact')" style="background: #10b981; color: white; padding: 15px 30px; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            üìß Nous Contacter
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- TAB FAQ -->
        <div id="tab-faq" class="tab-content">
            <div style="max-width: 800px; margin: 0 auto;">
                <h2 style="color: #333; margin-bottom: 30px; text-align: center; font-size: 28px;">
                    ‚ùì Foire Aux Questions (FAQ)
                </h2>

                <div class="faq-item">
                    <div class="faq-question">1. Qu'est-ce que DictaMed ?</div>
                    <p class="faq-answer">
                        <strong>DictaMed</strong> est une plateforme innovante de dict√©e m√©dicale propuls√©e par intelligence artificielle qui r√©volutionne la collecte de donn√©es cliniques. Con√ßue sp√©cifiquement pour les professionnels de sant√© et les chercheurs, elle transforme instantan√©ment vos enregistrements vocaux en donn√©es structur√©es et exploitables.
                        <br><br>
                        Au lieu de passer des heures √† saisir manuellement les informations de chaque patient dans SPSS, vous dictez simplement les donn√©es cliniques. Notre IA transcrit automatiquement vos enregistrements, les organise dans un fichier Excel en ligne (Google Sheets), puis notre √©quipe transforme ces donn√©es en fichier SPSS pr√™t pour vos analyses statistiques.
                        <br><br>
                        <strong>Le gain de temps est consid√©rable :</strong> ce qui prenait des jours de saisie fastidieuse ne prend plus que quelques minutes de dict√©e !
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">2. Comment fonctionne le Mode Test ?</div>
                    <p class="faq-answer">
                        Le <strong>Mode Test</strong> est votre terrain d'essai gratuit et sans engagement pour d√©couvrir toute la puissance de DictaMed. Voici comment cela fonctionne :
                        <br><br>
                        <strong>1Ô∏è‚É£ Aucune inscription requise</strong> - Pas besoin de cr√©er un compte ou de fournir vos coordonn√©es
                        <br><strong>2Ô∏è‚É£ Dict√©e en temps r√©el</strong> - Enregistrez vos donn√©es vocales exactement comme en mode professionnel
                        <br><strong>3Ô∏è‚É£ R√©sultats instantan√©s</strong> - Consultez imm√©diatement la transcription sur notre Google Sheet de d√©monstration
                        <br><strong>4Ô∏è‚É£ Consultation uniquement</strong> - En Mode Test, vous pouvez voir mais pas modifier les donn√©es
                        <br><br>
                        <strong>üí° Diff√©rence avec le Mode Normal :</strong> En mode Mode Normal (payant), vous b√©n√©ficiez d'un Google Sheet personnel o√π vous pouvez modifier, corriger et enrichir vos donn√©es √† volont√©. Vous recevez √©galement le fichier SPSS final transform√© et pr√™t pour vos analyses.
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">3. Mes donn√©es sont-elles s√©curis√©es ?</div>
                    <p class="faq-answer">
                        <strong>La s√©curit√© et la confidentialit√© sont au c≈ìur de DictaMed.</strong> Nous comprenons que vous manipulez des donn√©es m√©dicales sensibles, c'est pourquoi nous avons mis en place des mesures de protection rigoureuses :
                        <br><br>
                        <strong>üîí Chiffrement de bout en bout</strong> - Toutes vos donn√©es sont chiffr√©es lors de la transmission et du stockage
                        <br><strong>üá™üá∫ Conformit√© RGPD</strong> - Respect strict des r√®glementations europ√©ennes sur la protection des donn√©es
                        <br><strong>üè• Normes m√©dicales</strong> - Application des standards de confidentialit√© du secteur de la sant√©
                        <br><strong>üîê Acc√®s s√©curis√©</strong> - Authentification personnelle avec identifiant et code d'acc√®s uniques
                        <br><strong>üóÇÔ∏è Stockage isol√©</strong> - Chaque utilisateur dispose de son propre espace de donn√©es cloisonn√©
                        <br><br>
                        <strong>Note :</strong> Le Mode Test utilise uniquement des donn√©es anonymis√©es fictives √† des fins de d√©monstration. Aucune donn√©e r√©elle de patient n'est stock√©e en mode test.
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">4. Quels navigateurs sont compatibles ?</div>
                    <p class="faq-answer">
                        DictaMed fonctionne sur tous les navigateurs modernes : <strong>Google Chrome (recommand√©), Mozilla Firefox, Microsoft Edge, et Safari</strong>. Assurez-vous d'autoriser l'acc√®s au microphone lorsque demand√©.
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">5. Puis-je mettre en pause un enregistrement ?</div>
                    <p class="faq-answer">
                        Oui ! Chaque section dispose d'un bouton <strong>Pause</strong> qui vous permet d'interrompre l'enregistrement temporairement. Cliquez sur "Reprendre" pour continuer l√† o√π vous vous √™tes arr√™t√©. Le timer compte le temps total r√©el d'enregistrement.
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">6. Comment obtenir un devis personnalis√© ?</div>
                    <p class="faq-answer">
                        Contactez-nous par email √† <strong>DictaMed.SPSS@gmail.com</strong> en pr√©cisant : le nombre de patients, les param√®tres √† collecter, et vos besoins sp√©cifiques. Nous vous enverrons un devis d√©taill√© sous 48h ouvr√©es.
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">7. Quelle est la pr√©cision de la transcription ?</div>
                    <p class="faq-answer">
                        DictaMed utilise les technologies d'IA les plus avanc√©es du march√©, avec une <strong>pr√©cision de transcription sup√©rieure √† 95%</strong> dans des conditions optimales. Notre syst√®me s'am√©liore continuellement gr√¢ce au machine learning.
                        <br><br>
                        <strong>üìä Pour obtenir les meilleurs r√©sultats :</strong>
                        <br>‚úì Parlez clairement et √† un rythme normal (ni trop vite, ni trop lent)
                        <br>‚úì Utilisez un environnement calme, sans bruit de fond
                        <br>‚úì Tenez votre t√©l√©phone/micro √† environ 15-20 cm de votre bouche
                        <br>‚úì √âvitez de manger, boire ou m√¢cher pendant l'enregistrement
                        <br>‚úì Articulez bien les termes m√©dicaux complexes
                        <br><br>
                        <strong>üîß Correction facile :</strong> M√™me si une erreur de transcription se produit, vous pouvez facilement corriger les donn√©es directement dans votre Google Sheet personnel. Le syst√®me s'adapte √©galement √† votre vocabulaire m√©dical au fil du temps.
                        <br><br>
                        <strong>üí° Astuce :</strong> Pour les chiffres et les valeurs critiques (dosages, r√©sultats biologiques), nous recommandons de les √©noncer deux fois pour garantir une transcription parfaite.
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">8. Puis-je personnaliser les param√®tres √† collecter ?</div>
                    <p class="faq-answer">
                        Absolument ! En mode Mode Normal, nous adaptons les sections et param√®tres selon vos besoins sp√©cifiques. Que vous soyez en <strong>cardiologie, diab√©tologie, ou autre sp√©cialit√©</strong>, nous configurons l'outil pour votre pratique.
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">9. Y a-t-il une limite au nombre d'enregistrements ?</div>
                    <p class="faq-answer">
                        Il n'y a <strong>pas de limite</strong> au nombre d'enregistrements que vous pouvez effectuer, que ce soit en Mode Test ou en mode Mode Normal. La seule limitation concerne le nombre de patients inclus dans votre abonnement.
                    </p>
                </div>

                <div class="faq-item">
                    <div class="faq-question">10. Comment sont trait√©es les donn√©es apr√®s transcription ?</div>
                    <p class="faq-answer">
                        Le traitement de vos donn√©es suit un processus optimis√© en plusieurs √©tapes pour vous garantir un fichier SPSS parfaitement exploitable :
                        <br><br>
                        <strong>üé§ √âtape 1 : Dict√©e vocale</strong>
                        <br>Vous enregistrez les donn√©es de chaque patient section par section via l'interface DictaMed
                        <br><br>
                        <strong>ü§ñ √âtape 2 : Transcription automatique</strong>
                        <br>Notre IA transcrit instantan√©ment vos enregistrements en texte structur√©
                        <br><br>
                        <strong>üìä √âtape 3 : Collecte dans Google Sheets</strong>
                        <br>Les donn√©es transcrites s'inscrivent automatiquement dans votre tableau Excel en ligne personnalis√©. Vous pouvez consulter et modifier vos donn√©es en temps r√©el depuis n'importe quel appareil.
                        <br><br>
                        <strong>‚úÖ √âtape 4 : V√©rification et correction (optionnel)</strong>
                        <br>Vous pouvez relire et corriger toute donn√©e si n√©cessaire directement dans le Google Sheet
                        <br><br>
                        <strong>üìà √âtape 5 : Transformation en SPSS</strong>
                        <br>Une fois tous vos patients saisis, notre √©quipe d'experts transforme votre fichier Excel en fichier SPSS professionnel pr√™t pour vos analyses statistiques.
                        <br><br>
                        <strong>üöÄ R√©sultat final :</strong> Vous recevez un fichier SPSS (.sav) pr√™t √† l'emploi pour vos analyses - plus besoin de manipulations suppl√©mentaires !
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB CONTACT -->
        <div id="tab-contact" class="tab-content">
            <div style="max-width: 700px; margin: 0 auto;">
                <h2 style="color: #333; margin-bottom: 25px; text-align: center; font-size: 28px;">
                    üìß Contactez-nous
                </h2>
                
                <div style="background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%); border: 2px solid #2563eb; border-radius: 15px; padding: 30px; margin-bottom: 25px;">
                    <h3 style="color: #0c4a6e; margin-bottom: 20px; font-size: 22px;">
                        üíº Commander DictaMed
                    </h3>
                    <p style="color: #0c4a6e; font-size: 16px; line-height: 1.8; margin-bottom: 20px;">
                        Int√©ress√© par notre solution de dict√©e m√©dicale intelligente ? Contactez-nous pour obtenir un devis personnalis√© adapt√© √† vos besoins.
                    </p>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <p style="color: #0c4a6e; font-size: 18px; margin-bottom: 15px;">
                            <strong>üìß Email :</strong>
                        </p>
                        <a href="mailto:DictaMed.SPSS@gmail.com" style="color: #2563eb; font-size: 20px; font-weight: 600; text-decoration: none; display: block; padding: 12px; background: #f0f9ff; border-radius: 8px; text-align: center;">
                            DictaMed.SPSS@gmail.com
                        </a>
                    </div>
                    
                    <div style="background: #fef3c7; padding: 20px; border-radius: 10px; border-left: 4px solid #f59e0b;">
                        <h4 style="color: #78350f; margin-bottom: 12px; font-size: 18px;">
                            üí∞ Tarification
                        </h4>
                        <p style="color: #78350f; font-size: 15px; line-height: 1.8;">
                            Notre tarification est flexible et s'adapte √† vos besoins :
                        </p>
                        <ul style="color: #78350f; margin-left: 20px; margin-top: 10px; line-height: 1.8;">
                            <li><strong>Prix selon le nombre de patients</strong> √† traiter.</li>
                            <li><strong>Prix selon le nombre de variables</strong> √† recueillir.</li>
                        </ul>
                    </div>
                </div>
                
                <div style="background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 15px; padding: 25px;">
                    <h3 style="color: #334155; margin-bottom: 15px; font-size: 20px;">
                        üìù Informations √† fournir dans votre demande :
                    </h3>
                    <ul style="color: #475569; line-height: 2; margin-left: 20px;">
                        <li>Nom et pr√©nom du demandeur.</li>
                        <li>Num√©ro de t√©l√©phone.</li>
                        <li>Nom de votre √©tablissement/structure.</li>
                        <li>Nombre de patients pr√©vus.</li>
                        <li>Fichier SPSS pr√™t √† remplir avec les variables souhait√©es.</li>
                        <li>Date de d√©marrage souhait√©e.</li>
                    </ul>
                    
                    <p style="color: #475569; margin-top: 20px; font-style: italic; text-align: center;">
                        ‚è±Ô∏è Nous vous r√©pondons sous 48h ouvr√©es.
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB FAQ -->
        <div id="tab-faq" class="tab-content">
            <div style="max-width: 800px; margin: 0 auto;">
                <h2 style="color: #333; margin-bottom: 30px; text-align: center; font-size: 28px;">
                    ‚ùì Foire Aux Questions (FAQ)
                </h2>
                
                <div class="faq-item">
                    <h3 class="faq-question">1. Qu'est-ce que DictaMed ?</h3>
                    <p class="faq-answer">
                        DictaMed est une solution innovante de dict√©e m√©dicale assist√©e par intelligence artificielle. Elle permet aux m√©decins d'enregistrer vocalement les donn√©es de leurs patients qui sont ensuite automatiquement transcrites et structur√©es. DictaMed facilite grandement la collecte des donn√©es m√©dicales en √©vitant la saisie manuelle fastidieuse, pour que les donn√©es soient directement exploitables sur SPSS.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">2. Comment fonctionne le Mode Test ?</h3>
                    <p class="faq-answer">
                        Le Mode Test est une d√©monstration gratuite qui vous permet d'essayer DictaMed sans engagement. Enregistrez vos dict√©es vocales et consultez les r√©sultats en temps r√©el sur notre Google Sheet de d√©monstration. En Mode Test, vous pouvez uniquement consulter les donn√©es. En mode Mode Normal, vous pourrez modifier directement vos donn√©es sur le Google Sheet en cas de besoin. Aucune authentification n'est requise pour le Mode Test.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">3. Mes donn√©es sont-elles s√©curis√©es ?</h3>
                    <p class="faq-answer">
                        Oui, la s√©curit√© est notre priorit√©. En mode Mode Normal, toutes les donn√©es sont chiffr√©es et stock√©es de mani√®re s√©curis√©e. Nous respectons le RGPD et les normes de confidentialit√© m√©dicale. Le Mode Test utilise des donn√©es anonymis√©es uniquement √† des fins de d√©monstration.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">4. Quels navigateurs sont compatibles ?</h3>
                    <p class="faq-answer">
                        DictaMed fonctionne sur tous les navigateurs modernes : Google Chrome (recommand√©), Mozilla Firefox, Microsoft Edge, et Safari. Assurez-vous d'autoriser l'acc√®s au microphone lorsque demand√©.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">5. Puis-je mettre en pause un enregistrement ?</h3>
                    <p class="faq-answer">
                        Oui ! Chaque section dispose d'un bouton Pause qui vous permet d'interrompre l'enregistrement temporairement. Cliquez sur "Reprendre" pour continuer l√† o√π vous vous √™tes arr√™t√©. Le timer compte le temps total r√©el d'enregistrement.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">6. Comment obtenir un devis personnalis√© ?</h3>
                    <p class="faq-answer">
                        Contactez-nous par email √† <strong>DictaMed.SPSS@gmail.com</strong> en pr√©cisant : le nombre de patients, les param√®tres √† collecter, et vos besoins sp√©cifiques. Nous vous enverrons un devis d√©taill√© sous 48h ouvr√©es.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">7. Quelle est la pr√©cision de la transcription ?</h3>
                    <p class="faq-answer">
                        DictaMed utilise des technologies d'IA avanc√©es offrant une pr√©cision de transcription sup√©rieure √† 95% dans des conditions optimales. Pour les meilleurs r√©sultats, parlez clairement dans un environnement calme. Les donn√©es transcrites peuvent √™tre v√©rifi√©es et corrig√©es directement sur le Google Sheet si n√©cessaire.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">8. Puis-je personnaliser les param√®tres √† collecter ?</h3>
                    <p class="faq-answer">
                        Absolument ! En mode Mode Normal, nous adaptons les sections et param√®tres selon vos besoins sp√©cifiques. Que vous soyez en cardiologie, diab√©tologie, ou autre sp√©cialit√©, nous configurons l'outil pour votre pratique.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">9. Y a-t-il une limite au nombre d'enregistrements ?</h3>
                    <p class="faq-answer">
                        Il n'y a pas de limite au nombre d'enregistrements que vous pouvez effectuer, que ce soit en Mode Test ou en mode Mode Normal. La seule limitation concerne le nombre de patients inclus dans votre abonnement.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">10. Comment sont trait√©es les donn√©es apr√®s transcription ?</h3>
                    <p class="faq-answer">
                        Les donn√©es transcrites sont d'abord collect√©es dans Google Sheets ou Excel. Par la suite, l'√©quipe DictaMed transforme ces fichiers en format SPSS pour vous permettre d'analyser directement vos donn√©es sans manipulation suppl√©mentaire. Vous b√©n√©ficiez ainsi d'un fichier pr√™t √† l'emploi pour vos analyses statistiques.
                    </p>
                </div>
            </div>
        </div>

        <!-- TAB TEST -->
        <div id="tab-test" class="tab-content">
            <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 15px; padding: 20px; margin-bottom: 25px;">
                <h3 style="color: #92400e; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; font-size: 20px; font-weight: 700;">
                    <span>üí°</span> Consignes d'utilisation - Mode Test
                </h3>
                <div style="color: #78350f; line-height: 1.8; font-size: 14px;">
                    <p style="margin-bottom: 12px;"><strong>üì¢ Comment dicter correctement :</strong></p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li><strong>Parlez √† haute voix et lentement</strong> pour une meilleure reconnaissance</li>
                        <li><strong>Articulez bien</strong> chaque mot, surtout les chiffres et les valeurs</li>
                        <li>Utilisez un environnement <strong>calme</strong> sans bruit de fond</li>
                    </ul>
                    
                    <p style="margin-bottom: 12px;"><strong>üìù Format de dict√©e :</strong></p>
                    <ul style="margin-left: 20px; margin-bottom: 15px;">
                        <li><strong>Donn√©es cliniques :</strong> Dictez chaque √©l√©ment clairement
                            <br><em>Exemple : "√Çge 45 ans, sexe masculin, BMI 28, tabac oui"</em>
                        </li>
                        <li><strong>Ant√©c√©dents :</strong> R√©pondez par "oui" ou "non" pour chaque item
                            <br><em>Exemple : "HTA oui, DT2 non, dyslipid√©mie oui, AVC non"</em>
                        </li>
                        <li><strong>Biologie :</strong> Dictez les valeurs <strong>sans les unit√©s</strong>
                            <br><em>Exemple : "H√©moglobine 13.5, globules blancs 7000, plaquettes 250000, ur√©e 7, cr√©atinine 92, potassium 4.2, sodium 140, chlore 102"</em>
                        </li>
                    </ul>
                    
                    <p style="background: white; padding: 10px; border-radius: 8px; font-weight: 600; color: #92400e;">
                        ‚ö†Ô∏è Important : Faites une courte pause entre chaque valeur pour une meilleure reconnaissance
                    </p>
                    
                    <p style="margin-top: 15px; background: #fee2e2; padding: 12px; border-radius: 8px; border-left: 4px solid #dc2626;">
                        <strong style="color: #dc2626;">üìä Voir les r√©sultats de votre test :</strong><br>
                        <a href="https://docs.google.com/spreadsheets/d/1ReZHjndHc6o8O1bx1OfZXnZ8HWt8nLSo2X7IS6rcZXE/edit?usp=sharing" target="_blank" style="color: #2563eb; text-decoration: underline; font-weight: 600;">
                            Dicta MED Test - Google Sheets
                        </a>
                        <br><span style="font-size: 13px; color: #991b1b;">Cliquez pour consulter vos transcriptions en temps r√©el</span>
                    </p>
                </div>
            </div>

            <div class="form-group">
                <label for="testPatientNumber">üìù Num√©ro de Dossier Patient *</label>
                <input type="text" id="testPatientNumber" placeholder="Ex: 478/2024" maxlength="50" required oninput="updateCharCount('testPatientNumber', 50)">
                <div class="char-counter" id="counter-testPatientNumber">0/50</div>
            </div>

            <div class="form-group">
                <label for="testPatientName">üë§ Nom et Pr√©nom du Patient *</label>
                <input type="text" id="testPatientName" placeholder="Ex: Ben Saleh Kamel" maxlength="50" required oninput="updateCharCount('testPatientName', 50)">
                <div class="char-counter" id="counter-testPatientName">0/50</div>
            </div>

            <div class="sections-container" id="sections-test"></div>
            
            <div class="submit-section">
                <div class="submit-info">
                    <div class="recording-count" id="recordingCount-test">0 section(s) enregistr√©e(s)</div>
                </div>
                <button class="submit-btn" id="submitBtn-test" onclick="sendToN8n('test')" disabled>
                    <span>üì§</span> Envoyer
                </button>
            </div>
        </div>
    </div>

    <script>
        let currentTab = 'normal';
        
        const recordings = {
            normal: {
                clinique: { blob: null, mediaRecorder: null, chunks: [], timer: null, startTime: null, pausedTime: 0, isPaused: false, stream: null, outputFormat: 'wav', mimeType: null },
                antecedents: { blob: null, mediaRecorder: null, chunks: [], timer: null, startTime: null, pausedTime: 0, isPaused: false, stream: null, outputFormat: 'wav', mimeType: null },
                biologie: { blob: null, mediaRecorder: null, chunks: [], timer: null, startTime: null, pausedTime: 0, isPaused: false, stream: null, outputFormat: 'wav', mimeType: null },
                partie4: { blob: null, mediaRecorder: null, chunks: [], timer: null, startTime: null, pausedTime: 0, isPaused: false, stream: null, outputFormat: 'wav', mimeType: null }
            },
            test: {
                clinique: { blob: null, mediaRecorder: null, chunks: [], timer: null, startTime: null, pausedTime: 0, isPaused: false, stream: null, outputFormat: 'wav', mimeType: null },
                antecedents: { blob: null, mediaRecorder: null, chunks: [], timer: null, startTime: null, pausedTime: 0, isPaused: false, stream: null, outputFormat: 'wav', mimeType: null },
                biologie: { blob: null, mediaRecorder: null, chunks: [], timer: null, startTime: null, pausedTime: 0, isPaused: false, stream: null, outputFormat: 'wav', mimeType: null }
            }
        };

        const sectionsConfig = {
            normal: [
                { id: 'clinique', icon: '1Ô∏è‚É£', title: 'Partie 1', guide: '' },
                { id: 'antecedents', icon: '2Ô∏è‚É£', title: 'Partie 2', guide: '' },
                { id: 'biologie', icon: '3Ô∏è‚É£', title: 'Partie 3', guide: '' }
            ],
            test: [
                { id: 'clinique', icon: 'ü©∫', title: 'Donn√©es Cliniques', guide: '<strong>Param√®tres √† dicter :</strong><br>√Çge, sexe, BMI, tabac' },
                { id: 'antecedents', icon: 'üìö', title: 'Ant√©c√©dents', guide: '<strong>Param√®tres √† dicter :</strong><br>HTA, DT2, dyslipid√©mie, AVC' },
                { id: 'biologie', icon: 'üß™', title: 'Biologie', guide: '<strong>Param√®tres √† dicter :</strong><br>H√©moglobine, globules blancs, plaquettes, ur√©e, cr√©atinine, ionogramme (potassium, sodium, chlore)' }
            ]
        };

        let showPartie4 = false;

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            const activeTabBtn = document.querySelector(`.tab[onclick*="'${tab}'"]`);
            if (activeTabBtn) activeTabBtn.classList.add('active');
            
            document.getElementById(`tab-${tab}`).classList.add('active');
        }

        function createSections(mode) {
            const container = document.getElementById(`sections-${mode}`);
            container.innerHTML = '';
            
            const sections = mode === 'normal' && showPartie4 
                ? [...sectionsConfig[mode], { id: 'partie4', icon: '4Ô∏è‚É£', title: 'Partie 4', guide: '' }]
                : sectionsConfig[mode];
            
            sections.forEach(section => {
                const sectionHTML = `
                    <div class="section-card" id="section-${mode}-${section.id}">
                        <div class="section-header">
                            <div class="section-title">
                                <span>${section.icon}</span> ${section.title}
                            </div>
                            <span class="section-badge" id="badge-${mode}-${section.id}">Non enregistr√©</span>
                        </div>
                        ${section.guide ? `<div class="dictation-guide">${section.guide}</div>` : ''}
                        <div class="recorder-controls">
                            <button class="record-btn" onclick="startRecording('${mode}', '${section.id}')">
                                <span>üé§</span>
                                <span class="btn-text">
                                    <span class="btn-text-short">Rec</span>
                                    <span class="btn-text-full">Enregistrer</span>
                                </span>
                            </button>
                            <button class="stop-btn" id="pause-${mode}-${section.id}" onclick="pauseRecording('${mode}', '${section.id}')" disabled style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                                <span>‚è∏Ô∏è</span>
                                <span class="btn-text">Pause</span>
                            </button>
                            <button class="stop-btn" id="stop-${mode}-${section.id}" onclick="stopRecording('${mode}', '${section.id}')" disabled>
                                <span>‚èπÔ∏è</span>
                                <span class="btn-text">
                                    <span class="btn-text-short">Stop</span>
                                    <span class="btn-text-full">Terminer</span>
                                </span>
                            </button>
                            <button class="delete-btn" id="delete-${mode}-${section.id}" onclick="deleteRecording('${mode}', '${section.id}')" style="display: none;">
                                <span>üóëÔ∏è</span>
                                <span class="btn-text">
                                    <span class="btn-text-short">Sup</span>
                                    <span class="btn-text-full">Effacer</span>
                                </span>
                            </button>
                            <button class="stop-btn" id="replay-${mode}-${section.id}" onclick="replayRecording('${mode}', '${section.id}')" disabled style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); display: none;">
                                <span>‚ñ∂Ô∏è</span>
                                <span class="btn-text">
                                    <span class="btn-text-short">Play</span>
                                    <span class="btn-text-full">R√©√©couter</span>
                                </span>
                            </button>
                        </div>
                        <div class="timer" id="timer-${mode}-${section.id}">00:00</div>
                        <div class="status" id="status-${mode}-${section.id}">Pr√™t √† enregistrer</div>
                        <div class="audio-preview" id="preview-${mode}-${section.id}" style="display: none;">
                            <audio id="audio-${mode}-${section.id}" controls></audio>
                        </div>
                    </div>
                `;
                container.innerHTML += sectionHTML;
            });
        }

        async function startRecording(mode, section) {
            const rec = recordings[mode][section];
            
            // V√©rifier si un enregistrement est d√©j√† en cours
            if (rec.mediaRecorder && rec.mediaRecorder.state !== 'inactive') {
                showMessage('‚ö†Ô∏è Un enregistrement est d√©j√† en cours pour cette section.', 'error');
                return;
            }
            
            try {
                // Demander l'acc√®s au microphone avec configuration optimale
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    audio: {
                        echoCancellation: true,
                        noiseSuppression: true,
                        autoGainControl: true,
                        sampleRate: 44100 // Qualit√© CD
                    } 
                });
                
                // Essayer les formats dans l'ordre de pr√©f√©rence : MP3 > WAV > WebM > OGG
                let options = { mimeType: '' };
                let outputFormat = 'wav'; // Format par d√©faut pour le nom de fichier
                
                // Essayer audio/mpeg (MP3) - rare mais id√©al
                if (MediaRecorder.isTypeSupported('audio/mpeg')) {
                    options.mimeType = 'audio/mpeg';
                    outputFormat = 'mp3';
                }
                // Essayer audio/wav - rare mais second choix
                else if (MediaRecorder.isTypeSupported('audio/wav')) {
                    options.mimeType = 'audio/wav';
                    outputFormat = 'wav';
                }
                // Essayer audio/webm avec codec opus (bonne qualit√©, bonne compression)
                else if (MediaRecorder.isTypeSupported('audio/webm;codecs=opus')) {
                    options.mimeType = 'audio/webm;codecs=opus';
                    outputFormat = 'wav'; // Sera converti en WAV c√¥t√© serveur si besoin
                }
                // Essayer audio/webm standard
                else if (MediaRecorder.isTypeSupported('audio/webm')) {
                    options.mimeType = 'audio/webm';
                    outputFormat = 'wav';
                }
                // Essayer audio/ogg
                else if (MediaRecorder.isTypeSupported('audio/ogg;codecs=opus')) {
                    options.mimeType = 'audio/ogg;codecs=opus';
                    outputFormat = 'wav';
                }
                else if (MediaRecorder.isTypeSupported('audio/ogg')) {
                    options.mimeType = 'audio/ogg';
                    outputFormat = 'wav';
                }
                // Fallback : laisser le navigateur choisir
                else {
                    options.mimeType = '';
                    outputFormat = 'wav';
                }
                
                console.log('Format d\'enregistrement utilis√©:', options.mimeType || 'd√©faut du navigateur');
                
                rec.mediaRecorder = new MediaRecorder(stream, options);
                rec.chunks = [];
                rec.stream = stream;
                rec.outputFormat = outputFormat; // Stocker le format de sortie
                
                // G√©rer la collecte des donn√©es audio
                rec.mediaRecorder.ondataavailable = (event) => {
                    if (event.data && event.data.size > 0) {
                        rec.chunks.push(event.data);
                    }
                };
                
                // G√©rer la fin de l'enregistrement
                rec.mediaRecorder.onstop = () => {
                    if (rec.chunks.length > 0) {
                        // Cr√©er le blob avec le type MIME appropri√©
                        const mimeType = rec.mediaRecorder.mimeType || 'audio/webm';
                        rec.blob = new Blob(rec.chunks, { type: mimeType });
                        rec.mimeType = mimeType; // Stocker pour l'envoi
                        
                        const audioUrl = URL.createObjectURL(rec.blob);
                        
                        const audioElement = document.getElementById(`audio-${mode}-${section}`);
                        if (audioElement) {
                            audioElement.src = audioUrl;
                        }
                        
                        // Mettre √† jour l'interface
                        document.getElementById(`preview-${mode}-${section}`).style.display = 'block';
                        document.getElementById(`section-${mode}-${section}`).classList.add('has-recording');
                        
                        // Afficher le format utilis√© dans le badge
                        const formatLabel = rec.outputFormat === 'mp3' ? ' (MP3) ‚úì' : ' (WAV) ‚úì';
                        document.getElementById(`badge-${mode}-${section}`).textContent = 'Enregistr√©' + formatLabel;
                        document.getElementById(`badge-${mode}-${section}`).classList.add('recorded');
                        
                        updateSubmitButton(mode);
                    }
                    
                    // Nettoyer le stream
                    if (rec.stream) {
                        rec.stream.getTracks().forEach(track => track.stop());
                        rec.stream = null;
                    }
                };
                
                // G√©rer les erreurs d'enregistrement
                rec.mediaRecorder.onerror = (event) => {
                    console.error('Erreur MediaRecorder:', event.error);
                    showMessage('‚ùå Erreur lors de l\'enregistrement: ' + event.error, 'error');
                    cleanupRecording(mode, section);
                };
                
                // D√©marrer l'enregistrement
                rec.mediaRecorder.start();
                rec.startTime = Date.now();
                rec.pausedTime = 0;
                rec.isPaused = false;
                startTimer(mode, section);
                
                // Feedback haptique
                triggerHapticFeedback(50);
                
                // Mettre √† jour l'interface - d√©sactiver le bouton enregistrer
                const recordBtn = document.querySelector(`#section-${mode}-${section} .record-btn`);
                if (recordBtn) recordBtn.disabled = true;
                
                document.getElementById(`pause-${mode}-${section}`).disabled = false;
                document.getElementById(`stop-${mode}-${section}`).disabled = false;
                document.getElementById(`status-${mode}-${section}`).textContent = 'üî¥ Enregistrement en cours...';
                document.getElementById(`status-${mode}-${section}`).classList.add('recording');
                
            } catch (error) {
                console.error('Erreur startRecording:', error);
                
                let errorMessage = '‚ùå Impossible d\'acc√©der au microphone. ';
                
                if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') {
                    errorMessage += 'Veuillez autoriser l\'acc√®s au microphone dans les param√®tres de votre navigateur.';
                } else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') {
                    errorMessage += 'Aucun microphone d√©tect√© sur votre appareil.';
                } else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') {
                    errorMessage += 'Le microphone est peut-√™tre d√©j√† utilis√© par une autre application.';
                } else {
                    errorMessage += error.message;
                }
                
                showMessage(errorMessage, 'error');
                cleanupRecording(mode, section);
            }
        }

        function stopRecording(mode, section) {
            const rec = recordings[mode][section];
            
            // V√©rifier que l'enregistrement est actif
            if (!rec.mediaRecorder || rec.mediaRecorder.state === 'inactive') {
                showMessage('‚ö†Ô∏è Aucun enregistrement en cours.', 'error');
                return;
            }
            
            try {
                // Arr√™ter l'enregistrement
                if (rec.mediaRecorder.state === 'recording' || rec.mediaRecorder.state === 'paused') {
                    rec.mediaRecorder.stop();
                    
                    // Feedback haptique
                    triggerHapticFeedback(30);
                }
                
                // Arr√™ter le timer
                stopTimer(mode, section);
                
                // Mettre √† jour l'interface
                const recordBtn = document.querySelector(`#section-${mode}-${section} .record-btn`);
                if (recordBtn) recordBtn.disabled = false;
                
                document.getElementById(`pause-${mode}-${section}`).disabled = true;
                document.getElementById(`pause-${mode}-${section}`).innerHTML = '<span>‚è∏Ô∏è</span> <span class="btn-text">Pause</span>';
                document.getElementById(`stop-${mode}-${section}`).disabled = true;
                document.getElementById(`status-${mode}-${section}`).textContent = '‚úÖ Enregistrement termin√©';
                document.getElementById(`status-${mode}-${section}`).classList.remove('recording');
                document.getElementById(`delete-${mode}-${section}`).style.display = 'flex';
                
                // Afficher le bouton r√©√©couter
                const replayBtn = document.getElementById(`replay-${mode}-${section}`);
                if (replayBtn) {
                    replayBtn.style.display = 'flex';
                    replayBtn.disabled = false;
                }
                
            } catch (error) {
                console.error('Erreur stopRecording:', error);
                showMessage('‚ùå Erreur lors de l\'arr√™t de l\'enregistrement.', 'error');
                cleanupRecording(mode, section);
            }
        }

        function pauseRecording(mode, section) {
            const rec = recordings[mode][section];
            
            // V√©rifier que le MediaRecorder existe
            if (!rec.mediaRecorder) {
                return;
            }
            
            try {
                if (rec.mediaRecorder.state === 'recording') {
                    // Mettre en pause
                    rec.mediaRecorder.pause();
                    rec.isPaused = true;
                    rec.pausedTime += Date.now() - rec.startTime;
                    stopTimer(mode, section);
                    
                    document.getElementById(`pause-${mode}-${section}`).innerHTML = '<span>‚ñ∂Ô∏è</span> <span class="btn-text"><span class="btn-text-short">Play</span><span class="btn-text-full">Reprendre</span></span>';
                    document.getElementById(`pause-${mode}-${section}`).style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                    document.getElementById(`status-${mode}-${section}`).textContent = '‚è∏Ô∏è En pause...';
                    document.getElementById(`status-${mode}-${section}`).classList.remove('recording');
                    
                } else if (rec.mediaRecorder.state === 'paused') {
                    // Reprendre
                    rec.mediaRecorder.resume();
                    rec.isPaused = false;
                    rec.startTime = Date.now();
                    startTimer(mode, section);
                    
                    document.getElementById(`pause-${mode}-${section}`).innerHTML = '<span>‚è∏Ô∏è</span> <span class="btn-text">Pause</span>';
                    document.getElementById(`pause-${mode}-${section}`).style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                    document.getElementById(`status-${mode}-${section}`).textContent = 'üî¥ Enregistrement en cours...';
                    document.getElementById(`status-${mode}-${section}`).classList.add('recording');
                }
            } catch (error) {
                console.error('Erreur pauseRecording:', error);
                showMessage('‚ùå Erreur lors de la pause.', 'error');
            }
        }

        function deleteRecording(mode, section) {
            if (!confirm('Voulez-vous vraiment effacer cet enregistrement ?')) {
                return;
            }
            
            // Feedback haptique
            triggerHapticFeedback(40);
            
            const rec = recordings[mode][section];
            
            try {
                // Arr√™ter l'enregistrement si en cours
                if (rec.mediaRecorder && rec.mediaRecorder.state !== 'inactive') {
                    rec.mediaRecorder.stop();
                }
                
                // Arr√™ter le timer
                stopTimer(mode, section);
                
                // Nettoyer les donn√©es
                if (rec.blob) {
                    URL.revokeObjectURL(rec.blob);
                }
                rec.blob = null;
                rec.chunks = [];
                rec.pausedTime = 0;
                rec.isPaused = false;
                rec.mediaRecorder = null;
                rec.outputFormat = 'wav';
                rec.mimeType = null;
                
                // Lib√©rer le stream
                if (rec.stream) {
                    rec.stream.getTracks().forEach(track => track.stop());
                    rec.stream = null;
                }
                
                // Nettoyer l'audio
                const audio = document.getElementById(`audio-${mode}-${section}`);
                if (audio) {
                    audio.pause();
                    audio.currentTime = 0;
                    audio.src = '';
                }
                
                // R√©initialiser l'interface
                const recordBtn = document.querySelector(`#section-${mode}-${section} .record-btn`);
                if (recordBtn) recordBtn.disabled = false;
                
                document.getElementById(`preview-${mode}-${section}`).style.display = 'none';
                document.getElementById(`timer-${mode}-${section}`).textContent = '00:00';
                document.getElementById(`status-${mode}-${section}`).textContent = 'Pr√™t √† enregistrer';
                document.getElementById(`status-${mode}-${section}`).classList.remove('recording');
                document.getElementById(`delete-${mode}-${section}`).style.display = 'none';
                document.getElementById(`pause-${mode}-${section}`).innerHTML = '<span>‚è∏Ô∏è</span> <span class="btn-text">Pause</span>';
                document.getElementById(`pause-${mode}-${section}`).style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                document.getElementById(`pause-${mode}-${section}`).disabled = true;
                document.getElementById(`stop-${mode}-${section}`).disabled = true;
                
                // Masquer et d√©sactiver le bouton r√©√©couter
                const replayBtn = document.getElementById(`replay-${mode}-${section}`);
                if (replayBtn) {
                    replayBtn.style.display = 'none';
                    replayBtn.disabled = true;
                }
                
                document.getElementById(`section-${mode}-${section}`).classList.remove('has-recording');
                document.getElementById(`badge-${mode}-${section}`).textContent = 'Non enregistr√©';
                document.getElementById(`badge-${mode}-${section}`).classList.remove('recorded');
                
                updateSubmitButton(mode);
                showMessage('üóëÔ∏è Enregistrement effac√© avec succ√®s.', 'success');
                
            } catch (error) {
                console.error('Erreur deleteRecording:', error);
                showMessage('‚ùå Erreur lors de la suppression.', 'error');
            }
        }
        
        // Nouvelle fonction pour nettoyer un enregistrement en cas d'erreur
        function cleanupRecording(mode, section) {
            const rec = recordings[mode][section];
            
            try {
                // Arr√™ter le MediaRecorder si actif
                if (rec.mediaRecorder && rec.mediaRecorder.state !== 'inactive') {
                    rec.mediaRecorder.stop();
                }
                
                // Arr√™ter le timer
                stopTimer(mode, section);
                
                // Lib√©rer le stream
                if (rec.stream) {
                    rec.stream.getTracks().forEach(track => track.stop());
                    rec.stream = null;
                }
                
                // R√©initialiser l'objet
                rec.mediaRecorder = null;
                rec.chunks = [];
                rec.isPaused = false;
                rec.outputFormat = 'wav';
                rec.mimeType = null;
                
                // R√©initialiser l'interface
                const recordBtn = document.querySelector(`#section-${mode}-${section} .record-btn`);
                if (recordBtn) recordBtn.disabled = false;
                
                document.getElementById(`pause-${mode}-${section}`).disabled = true;
                document.getElementById(`pause-${mode}-${section}`).innerHTML = '<span>‚è∏Ô∏è</span> <span class="btn-text">Pause</span>';
                document.getElementById(`pause-${mode}-${section}`).style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                document.getElementById(`stop-${mode}-${section}`).disabled = true;
                document.getElementById(`status-${mode}-${section}`).textContent = 'Pr√™t √† enregistrer';
                document.getElementById(`status-${mode}-${section}`).classList.remove('recording');
                
            } catch (error) {
                console.error('Erreur cleanupRecording:', error);
            }
        }

        function startTimer(mode, section) {
            const rec = recordings[mode][section];
            rec.timer = setInterval(() => {
                const elapsed = Math.floor((rec.pausedTime + (Date.now() - rec.startTime)) / 1000);
                const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
                const seconds = (elapsed % 60).toString().padStart(2, '0');
                document.getElementById(`timer-${mode}-${section}`).textContent = `${minutes}:${seconds}`;
            }, 1000);
        }

        function stopTimer(mode, section) {
            const rec = recordings[mode][section];
            if (rec.timer) {
                clearInterval(rec.timer);
                rec.timer = null;
            }
        }

        function updateSubmitButton(mode) {
            const recordedCount = Object.values(recordings[mode]).filter(r => r.blob !== null).length;
            document.getElementById(`recordingCount-${mode}`).textContent = `${recordedCount} section(s) enregistr√©e(s)`;
            document.getElementById(`submitBtn-${mode}`).disabled = recordedCount === 0;
        }

        async function sendToN8n(mode) {
            // Feedback haptique
            triggerHapticFeedback(50);
            
            let NumeroDeDossier, NomDuPatient, username = null, accessCode = null;

            if (mode === 'normal') {
                username = document.getElementById('username').value.trim();
                accessCode = document.getElementById('accessCode').value.trim();
                NumeroDeDossier = document.getElementById('patientNumber').value.trim();
                NomDuPatient = document.getElementById('patientName').value.trim();

                if (!username) {
                    showMessage('‚ö†Ô∏è Veuillez saisir votre identifiant.', 'error');
                    return;
                }
                if (!accessCode) {
                    showMessage('‚ö†Ô∏è Veuillez saisir votre code d\'acc√®s.', 'error');
                    return;
                }
            } else {
                NumeroDeDossier = document.getElementById('testPatientNumber').value.trim();
                NomDuPatient = document.getElementById('testPatientName').value.trim();
            }

            if (!NumeroDeDossier) {
                showMessage('‚ö†Ô∏è Veuillez saisir un num√©ro de dossier patient.', 'error');
                return;
            }
            if (!NomDuPatient) {
                showMessage('‚ö†Ô∏è Veuillez saisir le nom et pr√©nom du patient.', 'error');
                return;
            }

            const recordedSections = Object.entries(recordings[mode]).filter(([_, rec]) => rec.blob !== null);
            
            if (recordedSections.length === 0) {
                showMessage('Veuillez enregistrer au moins une section.', 'error');
                return;
            }

            document.getElementById(`submitBtn-${mode}`).disabled = true;
            document.getElementById(`submitBtn-${mode}`).textContent = '‚è≥ Envoi en cours...';

            try {
                const audioPromises = recordedSections.map(([section, rec]) => {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.readAsDataURL(rec.blob);
                        reader.onloadend = function() {
                            resolve({
                                section: section,
                                audioBase64: reader.result.split(',')[1],
                                format: rec.outputFormat || 'wav', // Format de sortie (mp3 ou wav)
                                mimeType: rec.mimeType || 'audio/wav'
                            });
                        };
                    });
                });

                const audioData = await Promise.all(audioPromises);

                const payload = {
                    mode: mode,
                    NumeroDeDossier: NumeroDeDossier,
                    NomDuPatient: NomDuPatient,
                    recordedAt: new Date().toISOString(),
                    sections: {}
                };

                if (mode === 'normal') {
                    payload.username = username;
                    payload.accessCode = accessCode;
                }

                const fileNameMap = {
                    'clinique': 'msgVocal1',
                    'antecedents': 'msgVocal2',
                    'biologie': 'msgVocal3',
                    'partie4': 'msgVocal4'
                };

                audioData.forEach(data => {
                    const fileName = fileNameMap[data.section] || 'msgVocal';
                    const fileExtension = data.format; // mp3 ou wav
                    payload.sections[data.section] = {
                        audioBase64: data.audioBase64,
                        fileName: `${fileName}.${fileExtension}`,
                        mimeType: data.mimeType,
                        format: data.format
                    };
                });

                // S√©lectionner l'URL du webhook selon le mode
                const webhookURL = mode === 'test' 
                    ? 'https://n8n.srv1104707.hstgr.cloud/webhook/DictaMed'
                    : 'https://n8n.srv1104707.hstgr.cloud/webhook/DictaMedNormalMode';

                const response = await fetch(webhookURL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload),
                    mode: 'cors'
                });

                if (response.ok) {
                    showMessage('‚úÖ Dossier complet envoy√© avec succ√®s!', 'success');
                    resetForm(mode);
                } else {
                    const errorText = await response.text();
                    throw new Error(`Erreur HTTP ${response.status}: ${errorText}`);
                }
            } catch (error) {
                console.error('Erreur d√©taill√©e:', error);
                if (error.message.includes('Failed to fetch')) {
                    showMessage('‚ùå Erreur CORS: Veuillez configurer les CORS dans n8n', 'error');
                } else {
                    showMessage('‚ùå Erreur lors de l\'envoi: ' + error.message, 'error');
                }
                document.getElementById(`submitBtn-${mode}`).disabled = false;
            } finally {
                document.getElementById(`submitBtn-${mode}`).innerHTML = '<span>üì§</span> Envoyer';
            }
        }

        function showMessage(message, type) {
            const messageArea = document.getElementById('messageArea');
            const messageClass = type === 'success' ? 'success-message' : 'error-message';
            messageArea.innerHTML = `<div class="${messageClass}">${message}</div>`;
            
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        // Fonction de compteur de caract√®res
        function updateCharCount(inputId, maxLength) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(`counter-${inputId}`);
            
            if (!input || !counter) return;
            
            const currentLength = input.value.length;
            counter.textContent = `${currentLength}/${maxLength}`;
            
            // Changer la couleur selon le nombre de caract√®res
            counter.classList.remove('warning', 'limit');
            
            if (currentLength >= maxLength) {
                counter.classList.add('limit');
            } else if (currentLength >= maxLength * 0.8) {
                counter.classList.add('warning');
            }
        }

        // Fonction de feedback haptique (vibration)
        function triggerHapticFeedback(duration = 50) {
            if ('vibrate' in navigator) {
                navigator.vibrate(duration);
            }
        }

        function resetForm(mode) {
            if (mode === 'normal') {
                document.getElementById('username').value = '';
                document.getElementById('accessCode').value = '';
                document.getElementById('patientNumber').value = '';
                document.getElementById('patientName').value = '';
                
                // R√©initialiser les compteurs
                updateCharCount('patientNumber', 50);
                updateCharCount('patientName', 50);
            } else {
                document.getElementById('testPatientNumber').value = '';
                document.getElementById('testPatientName').value = '';
                
                // R√©initialiser les compteurs
                updateCharCount('testPatientNumber', 50);
                updateCharCount('testPatientName', 50);
            }
            
            Object.keys(recordings[mode]).forEach(section => {
                const sectionElement = document.getElementById(`section-${mode}-${section}`);
                if (sectionElement) {
                    const rec = recordings[mode][section];
                    
                    // Arr√™ter l'enregistrement si en cours
                    if (rec.mediaRecorder && rec.mediaRecorder.state !== 'inactive') {
                        rec.mediaRecorder.stop();
                    }
                    
                    // Arr√™ter le timer
                    stopTimer(mode, section);
                    
                    // Lib√©rer les ressources
                    if (rec.stream) {
                        rec.stream.getTracks().forEach(track => track.stop());
                    }
                    
                    if (rec.blob) {
                        URL.revokeObjectURL(rec.blob);
                    }
                    
                    // R√©initialiser l'objet
                    recordings[mode][section] = { 
                        blob: null, 
                        mediaRecorder: null, 
                        chunks: [], 
                        timer: null, 
                        startTime: null, 
                        pausedTime: 0, 
                        isPaused: false,
                        stream: null,
                        outputFormat: 'wav',
                        mimeType: null
                    };
                    
                    // Nettoyer l'audio
                    const audio = document.getElementById(`audio-${mode}-${section}`);
                    if (audio) {
                        audio.pause();
                        audio.currentTime = 0;
                        audio.src = '';
                    }
                    
                    // R√©initialiser l'interface
                    const recordBtn = sectionElement.querySelector('.record-btn');
                    if (recordBtn) recordBtn.disabled = false;
                    
                    document.getElementById(`preview-${mode}-${section}`).style.display = 'none';
                    document.getElementById(`timer-${mode}-${section}`).textContent = '00:00';
                    document.getElementById(`status-${mode}-${section}`).textContent = 'Pr√™t √† enregistrer';
                    document.getElementById(`status-${mode}-${section}`).classList.remove('recording');
                    document.getElementById(`delete-${mode}-${section}`).style.display = 'none';
                    document.getElementById(`pause-${mode}-${section}`).innerHTML = '<span>‚è∏Ô∏è</span> <span class="btn-text">Pause</span>';
                    document.getElementById(`pause-${mode}-${section}`).style.background = 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';
                    document.getElementById(`pause-${mode}-${section}`).disabled = true;
                    document.getElementById(`stop-${mode}-${section}`).disabled = true;
                    
                    // Masquer et d√©sactiver le bouton r√©√©couter
                    const replayBtn = document.getElementById(`replay-${mode}-${section}`);
                    if (replayBtn) {
                        replayBtn.style.display = 'none';
                        replayBtn.disabled = true;
                    }
                    
                    sectionElement.classList.remove('has-recording');
                    document.getElementById(`badge-${mode}-${section}`).textContent = 'Non enregistr√©';
                    document.getElementById(`badge-${mode}-${section}`).classList.remove('recorded');
                }
            });
            
            updateSubmitButton(mode);
        }

        function togglePartie4() {
            showPartie4 = !showPartie4;
            createSections('normal');
            const button = document.querySelector('#add-partie4-container button');
            if (showPartie4) {
                button.innerHTML = '<span>‚ûñ</span> Masquer Partie 4';
                button.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                button.style.boxShadow = '0 4px 12px rgba(239, 68, 68, 0.3)';
            } else {
                button.innerHTML = '<span>‚ûï</span> Ajouter Partie 4';
                button.style.background = 'linear-gradient(135deg, #2563eb 0%, #10b981 100%)';
                button.style.boxShadow = '0 4px 12px rgba(37, 99, 235, 0.3)';
            }
        }

        function replayRecording(mode, section) {
            const audio = document.getElementById(`audio-${mode}-${section}`);
            if (audio) {
                audio.play();
            }
        }

        // Initialiser les sections au chargement
        createSections('normal');
        createSections('test');
        
        // G√©rer les indicateurs de scroll pour les onglets
        const tabsContainer = document.querySelector('.tabs');
        
        if (tabsContainer) {
            // Fonction pour v√©rifier la position du scroll
            function checkScrollPosition() {
                const isScrolled = tabsContainer.scrollLeft > 10;
                const isAtEnd = tabsContainer.scrollLeft >= (tabsContainer.scrollWidth - tabsContainer.clientWidth - 10);
                
                if (isScrolled) {
                    tabsContainer.classList.add('scrolled');
                } else {
                    tabsContainer.classList.remove('scrolled');
                }
                
                if (isAtEnd) {
                    tabsContainer.classList.add('scrolled-end');
                } else {
                    tabsContainer.classList.remove('scrolled-end');
                }
            }
            
            // √âcouter le scroll
            tabsContainer.addEventListener('scroll', checkScrollPosition);
            
            // V√©rifier au chargement
            checkScrollPosition();
            
            // Rev√©rifier apr√®s un court d√©lai (au cas o√π le contenu charge)
            setTimeout(checkScrollPosition, 100);
            setTimeout(checkScrollPosition, 500);
        }
        
        // Initialiser les compteurs de caract√®res
        ['patientNumber', 'patientName', 'testPatientNumber', 'testPatientName'].forEach(id => {
            const input = document.getElementById(id);
            if (input) {
                updateCharCount(id, 50);
            }
        });
        
        // Nettoyer les ressources √† la fermeture de la page
        window.addEventListener('beforeunload', () => {
            ['normal', 'test'].forEach(mode => {
                Object.keys(recordings[mode]).forEach(section => {
                    const rec = recordings[mode][section];
                    
                    // Arr√™ter l'enregistrement si en cours
                    if (rec.mediaRecorder && rec.mediaRecorder.state !== 'inactive') {
                        rec.mediaRecorder.stop();
                    }
                    
                    // Lib√©rer le stream
                    if (rec.stream) {
                        rec.stream.getTracks().forEach(track => track.stop());
                    }
                    
                    // Lib√©rer les URLs d'objets
                    if (rec.blob) {
                        URL.revokeObjectURL(rec.blob);
                    }
                });
            });
        });
    </script>
</body>
</html>
